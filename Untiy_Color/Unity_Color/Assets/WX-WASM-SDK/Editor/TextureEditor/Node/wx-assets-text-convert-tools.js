/*! For license information please see wx-assets-text-convert-tools.js.LICENSE.txt */
(()=>{var t={487:t=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],o=0;o<t.length;o++)e.push(255&t.charCodeAt(o));return e},bytesToString:function(t){for(var e=[],o=0;o<t.length;o++)e.push(String.fromCharCode(t[o]));return e.join("")}}};t.exports=e},12:t=>{var e,o;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&o.rotl(t,8)|4278255360&o.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=o.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],o=0,s=0;o<t.length;o++,s+=8)e[s>>>5]|=t[o]<<24-s%32;return e},wordsToBytes:function(t){for(var e=[],o=0;o<32*t.length;o+=8)e.push(t[o>>>5]>>>24-o%32&255);return e},bytesToHex:function(t){for(var e=[],o=0;o<t.length;o++)e.push((t[o]>>>4).toString(16)),e.push((15&t[o]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],o=0;o<t.length;o+=2)e.push(parseInt(t.substr(o,2),16));return e},bytesToBase64:function(t){for(var o=[],s=0;s<t.length;s+=3)for(var i=t[s]<<16|t[s+1]<<8|t[s+2],n=0;n<4;n++)8*s+6*n<=8*t.length?o.push(e.charAt(i>>>6*(3-n)&63)):o.push("=");return o.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var o=[],s=0,i=0;s<t.length;i=++s%4)0!=i&&o.push((e.indexOf(t.charAt(s-1))&Math.pow(2,-2*i+8)-1)<<2*i|e.indexOf(t.charAt(s))>>>6-2*i);return o}},t.exports=o},738:t=>{function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(e(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}(t)||!!t._isBuffer)}},568:(t,e,o)=>{var s,i,n,r,c;s=o(12),i=o(487).utf8,n=o(738),r=o(487).bin,(c=function(t,e){t.constructor==String?t=e&&"binary"===e.encoding?r.stringToBytes(t):i.stringToBytes(t):n(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||t.constructor===Uint8Array||(t=t.toString());for(var o=s.bytesToWords(t),a=8*t.length,h=1732584193,u=-271733879,l=-1732584194,f=271733878,g=0;g<o.length;g++)o[g]=16711935&(o[g]<<8|o[g]>>>24)|4278255360&(o[g]<<24|o[g]>>>8);o[a>>>5]|=128<<a%32,o[14+(a+64>>>9<<4)]=a;var p=c._ff,d=c._gg,S=c._hh,m=c._ii;for(g=0;g<o.length;g+=16){var y=h,$=u,x=l,P=f;h=p(h,u,l,f,o[g+0],7,-680876936),f=p(f,h,u,l,o[g+1],12,-389564586),l=p(l,f,h,u,o[g+2],17,606105819),u=p(u,l,f,h,o[g+3],22,-1044525330),h=p(h,u,l,f,o[g+4],7,-176418897),f=p(f,h,u,l,o[g+5],12,1200080426),l=p(l,f,h,u,o[g+6],17,-1473231341),u=p(u,l,f,h,o[g+7],22,-45705983),h=p(h,u,l,f,o[g+8],7,1770035416),f=p(f,h,u,l,o[g+9],12,-1958414417),l=p(l,f,h,u,o[g+10],17,-42063),u=p(u,l,f,h,o[g+11],22,-1990404162),h=p(h,u,l,f,o[g+12],7,1804603682),f=p(f,h,u,l,o[g+13],12,-40341101),l=p(l,f,h,u,o[g+14],17,-1502002290),h=d(h,u=p(u,l,f,h,o[g+15],22,1236535329),l,f,o[g+1],5,-165796510),f=d(f,h,u,l,o[g+6],9,-1069501632),l=d(l,f,h,u,o[g+11],14,643717713),u=d(u,l,f,h,o[g+0],20,-373897302),h=d(h,u,l,f,o[g+5],5,-701558691),f=d(f,h,u,l,o[g+10],9,38016083),l=d(l,f,h,u,o[g+15],14,-660478335),u=d(u,l,f,h,o[g+4],20,-405537848),h=d(h,u,l,f,o[g+9],5,568446438),f=d(f,h,u,l,o[g+14],9,-1019803690),l=d(l,f,h,u,o[g+3],14,-187363961),u=d(u,l,f,h,o[g+8],20,1163531501),h=d(h,u,l,f,o[g+13],5,-1444681467),f=d(f,h,u,l,o[g+2],9,-51403784),l=d(l,f,h,u,o[g+7],14,1735328473),h=S(h,u=d(u,l,f,h,o[g+12],20,-1926607734),l,f,o[g+5],4,-378558),f=S(f,h,u,l,o[g+8],11,-2022574463),l=S(l,f,h,u,o[g+11],16,1839030562),u=S(u,l,f,h,o[g+14],23,-35309556),h=S(h,u,l,f,o[g+1],4,-1530992060),f=S(f,h,u,l,o[g+4],11,1272893353),l=S(l,f,h,u,o[g+7],16,-155497632),u=S(u,l,f,h,o[g+10],23,-1094730640),h=S(h,u,l,f,o[g+13],4,681279174),f=S(f,h,u,l,o[g+0],11,-358537222),l=S(l,f,h,u,o[g+3],16,-722521979),u=S(u,l,f,h,o[g+6],23,76029189),h=S(h,u,l,f,o[g+9],4,-640364487),f=S(f,h,u,l,o[g+12],11,-421815835),l=S(l,f,h,u,o[g+15],16,530742520),h=m(h,u=S(u,l,f,h,o[g+2],23,-995338651),l,f,o[g+0],6,-198630844),f=m(f,h,u,l,o[g+7],10,1126891415),l=m(l,f,h,u,o[g+14],15,-1416354905),u=m(u,l,f,h,o[g+5],21,-57434055),h=m(h,u,l,f,o[g+12],6,1700485571),f=m(f,h,u,l,o[g+3],10,-1894986606),l=m(l,f,h,u,o[g+10],15,-1051523),u=m(u,l,f,h,o[g+1],21,-2054922799),h=m(h,u,l,f,o[g+8],6,1873313359),f=m(f,h,u,l,o[g+15],10,-30611744),l=m(l,f,h,u,o[g+6],15,-1560198380),u=m(u,l,f,h,o[g+13],21,1309151649),h=m(h,u,l,f,o[g+4],6,-145523070),f=m(f,h,u,l,o[g+11],10,-1120210379),l=m(l,f,h,u,o[g+2],15,718787259),u=m(u,l,f,h,o[g+9],21,-343485551),h=h+y>>>0,u=u+$>>>0,l=l+x>>>0,f=f+P>>>0}return s.endian([h,u,l,f])})._ff=function(t,e,o,s,i,n,r){var c=t+(e&o|~e&s)+(i>>>0)+r;return(c<<n|c>>>32-n)+e},c._gg=function(t,e,o,s,i,n,r){var c=t+(e&s|o&~s)+(i>>>0)+r;return(c<<n|c>>>32-n)+e},c._hh=function(t,e,o,s,i,n,r){var c=t+(e^o^s)+(i>>>0)+r;return(c<<n|c>>>32-n)+e},c._ii=function(t,e,o,s,i,n,r){var c=t+(o^(e|~s))+(i>>>0)+r;return(c<<n|c>>>32-n)+e},c._blocksize=16,c._digestsize=16,t.exports=function(t,e){if(null==t)throw new Error("Illegal argument "+t);var o=s.wordsToBytes(c(t,e));return e&&e.asBytes?o:e&&e.asString?r.bytesToString(o):s.bytesToHex(o)}},28:(t,e,o)=>{"use strict";var s=o(838),i=s.spawn,n=s.exec;function r(t,e,o){var s={};try{Object.keys(t).forEach((function(o){t[o].forEach((function(t){s[t]||(c(t,e),s[t]=1)})),s[o]||(c(o,e),s[o]=1)}))}catch(t){if(o)return o(t);throw t}if(o)return o()}function c(t,e){try{process.kill(parseInt(t,10),e)}catch(t){if("ESRCH"!==t.code)throw t}}function a(t,e,o,s,i){var n=s(t),r="";n.stdout.on("data",(function(t){t=t.toString("ascii"),r+=t})),n.on("close",(function(n){delete o[t],0==n?r.match(/\d+/g).forEach((function(n){n=parseInt(n,10),e[t].push(n),e[n]=[],o[n]=1,a(n,e,o,s,i)})):0==Object.keys(o).length&&i()}))}t.exports=function(t,e,o){if("function"==typeof e&&void 0===o&&(o=e,e=void 0),t=parseInt(t),Number.isNaN(t)){if(o)return o(new Error("pid must be a number"));throw new Error("pid must be a number")}var s={},c={};switch(s[t]=[],c[t]=1,process.platform){case"win32":n("taskkill /pid "+t+" /T /F",o);break;case"darwin":a(t,s,c,(function(t){return i("pgrep",["-P",t])}),(function(){r(s,e,o)}));break;default:a(t,s,c,(function(t){return i("ps",["-o","pid","--no-headers","--ppid",t])}),(function(){r(s,e,o)}))}}},838:t=>{"use strict";t.exports=require("child_process")},936:t=>{"use strict";t.exports=require("os")}},e={};function o(s){var i=e[s];if(void 0!==i)return i.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,o),n.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var s in e)o.o(e,s)&&!o.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=o(936),e={MACOS:"Darwin"===t.type(),M1:t.cpus().some((t=>t.model.toLowerCase().indexOf("apple")>-1)),DS:function(){switch(process.platform){case"darwin":return"/";case"win32":return"\\"}return"/"}()},s=o(838).spawn,i=o(28),n=[1,2,5],r={4096:200,2048:80,1024:70,512:60,256:40};class c{execPath="";options=[];#t=30;#e=()=>{};#o=()=>{};constructor(t=2048){for(let e in r)if(t>=e)return void(this.#t=r[e]);this.#t=30}run(){return new Promise(((t,e)=>{this.#e=t,this.#o=e,this.#s()}))}#s(){this.refreshTimeout()?(this.#i=!0,this.child=s(this.execPath,this.options),this.child.stdout.on("data",(function(t){})),this.child.on("close",(t=>{0===t&&(clearTimeout(this.#n),this.#e())}))):this.#o()}#r=-1;#n=-1;#i=!1;refreshTimeout(){return this.#r++,!(this.#r>=n.length||(this.#n=setTimeout((()=>{this.retryProcess()}),n[this.#r]*this.#t*1e3),0))}retryProcess(){this.#i&&(i(this.child.pid),this.#i=!1),this.#s()}}const a=require("fs");var h=o.n(a);const u={ProgressMessage(t,e,o){console.log(`[PROGRESS]${t},${e},${o}`)},ConsoleMessage(t){console.log(`[LOG]${t}`)},ResponseMsg(t){console.log(`[DONE]${t}`)},RecordFile(t){console.log(`[RECORDFILE]${t}`)}},l=e.MACOS?e.M1?"astcenc-neon":"astcenc-avx2":"astcenc-sse4.1.exe";class f extends c{#c="";#a="";#h="8x8";#u="-cs";constructor(t,o,s,i="8x8",n=2048,r="Gamma"){super(n),this.execPath=`${t}${e.DS}${l}`,this.#c=o,this.#a=s,this.#h=i,this.#u="Linear"==r?"-cl":"-cs"}async convert(){try{await h().promises.access(this.#a),h().rmSync(this.#a)}catch(t){}const t=this.#a+".astc";this.options=[this.#u,this.#c,t,this.#h,"-medium"],await this.run();try{h().renameSync(t,this.#a)}catch(t){u.ConsoleMessage(`【ASTC - convert】#104 原 [${this.#c}] 资源 ASTC 格式生成失败！`)}}}const g=e.MACOS?"PVRTexToolCLI":"PVRTexToolCLI.exe";class p extends c{#c="";#a="";#u="";constructor(t,o,s,i=2048,n="Gamma"){super(i),this.execPath=`${t}${e.DS}${g}`,this.#c=o,this.#a=s,this.#u="Linear"==n?"lRGB":"sRGB"}async convert(){try{await h().promises.access(this.#a),h().rmSync(this.#a)}catch(t){}const t=this.#a+".dds";this.options=["-i",this.#c,"-o",t,"-f",`BC3,UBN,${this.#u}`],await this.run();try{h().renameSync(t,this.#a)}catch(t){u.ConsoleMessage(`【DXT - convert】#106 原 [${this.#c}] 资源 DXT 格式生成失败！`)}}}const d=e.MACOS?"PVRTexToolCLI":"PVRTexToolCLI.exe";class S extends c{#c="";#a="";#u="";constructor(t,o,s,i=2048,n="Gamma"){super(i),this.execPath=`${t}${e.DS}${d}`,this.#c=o,this.#a=s,this.#u="Linear"==n?"lRGB":"sRGB"}async convert(){try{await h().promises.access(this.#a),h().rmSync(this.#a)}catch(t){}const t=this.#a+".pvr";this.options=["-i",this.#c,"-o",t,"-f",`ETC2_RGBA,UBN,${this.#u}`],await this.run();try{h().renameSync(t,this.#a)}catch(t){u.ConsoleMessage(`【ETC2 - convert】#107 原 [${this.#c}] 资源 ETC2 格式生成失败！`)}}}const m=e.MACOS?"pngquant":"pngquant.exe";class y extends c{#c="";#a="";constructor(t,o,s,i=2048,n="Gamma"){super(i),this.execPath=`${t}${e.DS}${m}`,this.#c=o,this.#a=s}async convert(){const t=this.#a+".dds";this.options=[this.#c,"-o",t,"-f"],await this.run(),h().rmSync(this.#c),h().renameSync(t,this.#c)}}const $=new class{#l;#f;#g;#p=!1;#d=[];constructor(){this.log("Wechat-assets-text-convert-tools Launch")}SetLogRoot(t){let o=new Date;const s=1e3+parseInt(8999*Math.random()),i=`WXLOGJS-${o.getHours()}-${o.getMinutes()}-${o.getSeconds()}-${s}.log`;let n=o.getMonth()+1;n<10&&(n="0"+n);let r=o.getDate();r<10&&(r="0"+r);const c=`${t}${e.DS}log${e.DS}${o.getFullYear()}${n}${r}`,a=`${c}${e.DS}${i}`;return this.#g=c,this.#l=a,this.#f=i,h().existsSync(this.#g)||h().mkdirSync(this.#g),h().existsSync(this.#l)||h().writeFileSync(this.#l,"",{encoding:"utf-8"}),this.#p=!0,this.#S(),this.#l}log(){if(!arguments||0==arguments.length)return;const t=arguments[0];let e=[];for(let t=1;t<arguments.length;t++)e.push(arguments[t]);let o={title:t,args:e};const s=JSON.stringify(o)+",";this.#m(s)}#y(){let t=new Date;t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()}#m(t){this.#p?h().appendFileSync(this.#l,t,{encoding:"utf-8"}):this.#d.push(t)}#S(){for(;;){let t=this.#d.shift();if(!t)return;this.#m(t)}}};class x{#l;#g;#$={};constructor(t){this.#g=t,this.#l=`${t}${e.DS}JSDEALSFILERECORD.json`,this.#x(),this.#P()}#x(){h().existsSync(this.#g)||h().mkdirSync(this.#g),h().existsSync(this.#l)||h().writeFileSync(this.#l,"",{encoding:"utf-8"})}#P(){const t=h().readFileSync(this.#l,{encoding:"utf-8"});this.#$=""==t?{timestamp:0,files:[]}:JSON.parse(t)}save(){this.#$.timestamp=(new Date).getTime();const t=JSON.stringify(this.#$);h().existsSync(this.#l)&&h().rmSync(this.#l),h().writeFileSync(this.#l,t,{encoding:"utf-8"})}getInfo(t){for(let e of this.#$.files)if(e.originPngPath==t)return e;return null}setInfo(t){let e=!1,o=0;for(;o<this.#$.files.length;o++)if(this.#$.files[o].originPngPath==t.originPngPath){e=!0;break}e?this.#$.files[o]=t:this.#$.files.push(t)}defaultStruct(t,e,o){return{name:e.name,width:e.width,height:e.height,astc:!1,dxt:!1,etc:!1,pngmin:!1,lpng:!1,lpngmin:!1,originPngPath:t,colorSpace:o}}}o(568);const P=o(936).cpus().length,w=e.DS,v=new class{constructor(t){for(let e of t)this.#w(e)}#v={};getConfig(t){return this.#v[t]}setConfig(t,e){this.#v[t]=e}#w(t=""){let e=t.indexOf("=");if(e<=0||e>=t.length-1)return;let o=t.substring(0,e),s=t.substring(e+1,t.length);this.#v[o]=s}printOptions(){console.log("<-------------输入配置字典 Start-------------\x3e");for(let t in this.#v)console.log(`Key:${t} - Value:${this.#v[t]}`);console.log("<-------------输入配置字典 End-------------\x3e")}}(process.argv);new class{#C;#T=P;#d=[];#D=!1;#u="Gamma";#b=0;#R="";#O=!1;#M=0;#k;constructor(t){this.#C=t}launch(){this.#I(),this.#P(),this.#A=!1;for(let t=0;t<this.#T;t++)this.#B()}#I(){const t=this.#C.getConfig("-dataDir");if(!t)throw u.ConsoleMessage("【WXTools - convert】#201 缺少必要配置参数 -dataDir"),{code:201,errmsg:"缺少必要配置参数 -dataDir"};const e=$.SetLogRoot(t);u.RecordFile(e),this.#k=new x(t);const o=this.#C.getConfig("-config");if(!o)throw u.ConsoleMessage("【WXTools - convert】#201 缺少必要配置参数 -config"),{code:201,errmsg:"缺少必要配置参数 -config"};if(!h().existsSync(o))throw u.ConsoleMessage(`【WXTools - convert】#202 参数配置 -config [${o}] 指向无效`),{code:202,errmsg:`参数配置 -config [${o}] 指向无效`};if(!this.#C.getConfig("-outDir"))throw u.ConsoleMessage("【WXTools - convert】#203 缺少必要配置参数 -outDir"),{code:203,errmsg:"缺少必要配置参数 -outDir"};const s=this.#C.getConfig("-force");s&&(this.#O="true"==s);const i=["Gamma","Linear"],n=this.#C.getConfig("-colorSpace");n||(n="Gamma");let r=!1;for(let t of i)if(t==n){r=!0;break}if(!r)throw u.ConsoleMessage(`【WXTools - convert】#206 参数配置 -colorSpace [${n}] 赋值不合法`),{code:206,errmsg:`参数配置 -colorSpace [${n}] 赋值不合法`};this.#u=n;const c=this.#C.getConfig("-execRoot");if(!c)throw u.ConsoleMessage("【WXTools - convert】#204 缺少必要配置参数 -execRoot"),{code:204,errmsg:"缺少必要配置参数 -execRoot"};const a=["astcenc-avx2","astcenc-avx2.exe","astcenc-neon","astcenc-sse4.1.exe","pngquant","pngquant.exe","PVRTexToolCLI","PVRTexToolCLI.exe"];for(let t of a)if(!h().existsSync(`${c}${w}${t}`))throw u.ConsoleMessage(`【WXTools - convert】#205 参数配置 -execRoot [${c}] 缺少必要文件 [${t}]`),{code:204,errmsg:`参数配置 -execRoot [${c}] 缺少必要文件 [${t}]`};this.#R=c;const l=this.#C.getConfig("-type");this.#D=!(!l||"ASTC"!=l)}#P(){const t=h().readFileSync(this.#C.getConfig("-config"),{encoding:"utf-8"}),e=JSON.parse(t),o=this.#C.getConfig("-outDir");for(let t of e.files)for(let e of t.textures){let t=decodeURIComponent(e.name),s=!1;for(let o of this.#d)if(o.name==t&&o.width==e.width){s=!0;break}if(s)continue;const i=`${o}${w}png${w}${e.width}${w}${t}.png`;if(!h().existsSync(i))continue;let n={name:t,width:e.width,height:e.height,astc:null==e.astc?"8x8":e.astc,limittype:e.limittype,path:`${o}${w}png${w}${e.width}${w}${t}.png`};h().existsSync(n.path)&&this.#d.push(n)}this.#b=this.#d.length;const s=`${o}${w}`;h().existsSync(`${s}astc`)||(this.#F=!0),h().existsSync(`${s}dds`)||(this.#_=!0),h().existsSync(`${s}etc2`)||(this.#L=!0)}#F=!1;#_=!1;#L=!1;async#B(){for(;;){const t=this.#d.shift();if(!t)break;(new Date).getTime();const e=t.path,o=this.#C.getConfig("-outDir");let s=this.#k.getInfo(e);s||(s=this.#k.defaultStruct(e,t,this.#u)),this.#E(e);let i="",n="";if(this.#O||this.#F||!s.astc||s.colorSpace!=this.#u){(new Date).getTime(),i=`${o}${w}astc${w}${t.width}${w}`,n=`${i}${t.name}.txt`,this.#q(i);try{const o=new f(this.#R,e,n,t.astc,t.width,this.#u);await o.convert(),s.astc=!0}catch(t){u.ConsoleMessage(`Output path:[${n}] is failed.`)}}if(this.#D)this.#k.setInfo(s);else{if(this.#O||this.#_||!s.dxt||s.colorSpace!=this.#u){(new Date).getTime(),i=`${o}${w}dds${w}${t.width}${w}`,n=`${i}${t.name}.txt`,this.#q(i);try{const o=new p(this.#R,e,n,t.width,this.#u);await o.convert(),s.dxt=!0}catch(t){u.ConsoleMessage(`Output path:[${n}] is failed.`)}}if(this.#O||this.#L||!s.etc||s.colorSpace!=this.#u){(new Date).getTime(),i=`${o}${w}etc2${w}${t.width}${w}`,n=`${i}${t.name}.txt`,this.#q(i);try{const o=new S(this.#R,e,n,t.width,this.#u);await o.convert(),s.etc=!0}catch(t){u.ConsoleMessage(`Output path:[${n}] is failed.`)}}if(this.#O||!s.pngmin){(new Date).getTime();try{const o=new y(this.#R,e,e,t.width,this.#u);await o.convert(),s.pngmin=!0}catch(t){u.ConsoleMessage(`Output path:[${n}] is failed.`)}}if("Linear"==this.#u&&(this.#O||!s.lpngmin))try{i=`${o}${w}lpng${w}${t.width}${w}`,lpngPath=`${i}${t.name}.png`;const e=new y(this.#R,lpngPath,lpngPath,t.width,this.#u);await e.convert(),s.lpngmin=!0}catch(t){u.ConsoleMessage(`Output path:[${n}] is failed.`)}this.#k.setInfo(s)}}this.#M++,this.#G()}#E(t){u.ProgressMessage(this.#b-this.#d.length,this.#b,t)}#q(t){h().existsSync(t)||h().mkdirSync(t,{recursive:!0})}#N(){return new Promise(((t,e)=>{setTimeout((()=>{t()}),100)}))}#A=!1;#G(){this.#M==this.#T&&(this.#A=!0,this.#k.save(),u.ResponseMsg("All Asset Textures have been converted!"))}}(v).launch()})()})();