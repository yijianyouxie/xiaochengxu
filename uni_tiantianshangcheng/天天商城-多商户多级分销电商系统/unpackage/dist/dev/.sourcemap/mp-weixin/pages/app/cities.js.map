{"version":3,"sources":["uni-app:///main.js","webpack:///D:/xiaochengxu/uni_tiantianshangcheng/天天商城-多商户多级分销电商系统/pages/app/cities.vue?0cf4","webpack:///D:/xiaochengxu/uni_tiantianshangcheng/天天商城-多商户多级分销电商系统/pages/app/cities.vue?eb70","webpack:///D:/xiaochengxu/uni_tiantianshangcheng/天天商城-多商户多级分销电商系统/pages/app/cities.vue?d2a9","webpack:///D:/xiaochengxu/uni_tiantianshangcheng/天天商城-多商户多级分销电商系统/pages/app/cities.vue?d37f","uni-app:///pages/app/cities.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,6F,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,eAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;;;AAGrD;AAC8M;AAC9M,gBAAgB,iNAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,+TAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAA6yB,CAAgB,oyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;ACOj0B,6B;AACA;AACA,MADA,kBACA;AACA;AACA,mBADA;AAEA,gBAFA;AAGA,iBAHA,EAGA;AACA,kBAJA;AAKA,kBALA;AAMA,qBANA;AAOA;AACA,uBADA;AAEA,uBAFA;AAGA,uBAHA;AAIA,uBAJA,EAPA;;;AAcA,GAhBA;AAiBA,QAjBA,kBAiBA,CAjBA,EAiBA;AACA;AACA;AACA;AACA;AACA,GAtBA;AAuBA;AACA,WADA,qBACA;AACA;AACA,KAHA,EAvBA;;AA4BA;AACA;;;AAGA,YAJA,sBAIA;AACA;AACA,2CADA,EACA,OADA;AAEA,iCAFA,EAEA,KAFA,CAEA,UAFA,EAEA,GAFA,GAEA,IAFA,CAEA;;AAEA,WADA,MACA,QADA,MACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BADA;AAEA,0BAFA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAFA,MAEA;AACA;AACA;AACA;AACA,SA1BA;AA2BA;AACA;AACA;AACA,mCADA;AAEA,2BAFA;;AAIA;AACA;AACA;AACA,wBADA;AAEA,oBAFA;;AAIA;AACA;AACA,OAnDA;AAoDA,KAzDA;AA0DA,eA1DA,yBA0DA;AACA;AACA;AACA;AACA;AACA;AACA,wDADA;AAEA,cAFA,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDADA;AAEA,iDAFA;AAGA,8DAHA;;AAKA,eAPA,MAOA;AACA;AACA,0DADA;AAEA,iDAFA;AAGA,+DAHA;;AAKA,eANA,MAMA;AACA;AACA;AACA,sDADA;AAEA,6CAFA;AAGA,0DAHA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA,CACA,IADA;AAEA,yBAFA,CAEA,CAFA,KAEA,CAFA;AAGA;AACA;AACA;AACA;AACA,eARA,MAQA;AACA;AACA,0CADA;AAEA;AACA,uCADA,CAFA;;;AAMA;AACA;AACA,WAhDA;AAiDA,SArDA;;AAuDA,KAlHA;AAmHA,cAnHA,sBAmHA,CAnHA,EAmHA;AACA;AACA,oBAFA,GAEA;AACA,oDADA;AAEA,mCAFA,EAFA;;AAMA;AACA;AACA;AACA;AACA;AACA,yCADA;AAEA,4BAFA,IAVA;;AAcA,6CAdA;AAeA;AACA,qCADA,GAfA;;AAkBA;AACA,2DAnBA;;AAqBA;AACA;AACA;AACA;AACA,8BADA;;AAGA,iBALA,EAtBA;AA4BA,KA/IA,EA5BA,E","file":"pages/app/cities.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/app/cities.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./cities.vue?vue&type=template&id=0ed2dea0&\"\nvar renderjs\nimport script from \"./cities.vue?vue&type=script&lang=js&\"\nexport * from \"./cities.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/app/cities.vue\"\nexport default component.exports","export * from \"-!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./cities.vue?vue&type=template&id=0ed2dea0&\"","var components\ntry {\n  components = {\n    uniIndexedList: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-indexed-list/components/uni-indexed-list/uni-indexed-list\" */ \"@/uni_modules/uni-indexed-list/components/uni-indexed-list/uni-indexed-list.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./cities.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!H:\\\\software\\\\小程序\\\\HBuilderX.3.4.7.20220422\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./cities.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<uni-indexed-list :options=\"dataList\" :showSelect=\"false\" @click=\"chooseCity\"></uni-indexed-list>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tconst db = uniCloud.database();\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlocalCity: {},\r\n\t\t\t\tlimit: 500,\r\n\t\t\t\tsave: false, //是否保存到用户信息里面\r\n\t\t\t\tcodeList: {},\r\n\t\t\t\tdataList: [],\r\n\t\t\t\thotLetter: \"热门\",\r\n\t\t\t\tzhixiashi: {\r\n\t\t\t\t\t\"北京市\": \"110000\",\r\n\t\t\t\t\t\"天津市\": \"120000\",\r\n\t\t\t\t\t\"重庆市\": \"500000\",\r\n\t\t\t\t\t\"上海市\": \"310000\",\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tif (e.save) {\r\n\t\t\t\tthis.save = e.save;\r\n\t\t\t}\r\n\t\t\tthis.loadData();\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tisLogin() {\r\n\t\t\t\treturn this.$store.getters['user/isTokenValid'];\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 一次性查询所有城市，可以本地缓存一下\r\n\t\t\t */\r\n\t\t\tloadData() {\r\n\t\t\t\tdb.collection(\"opendb-city-china\").where(\"(type==1) || (type==2 && is_recommend==true)\").field(\r\n\t\t\t\t\t\"code,name,first_letter,is_recommend\").orderBy(\r\n\t\t\t\t\t\"first_letter asc,name asc\").limit(this.limit).get().then(({\r\n\t\t\t\t\tresult\r\n\t\t\t\t}) => {\r\n\t\t\t\t\tconsole.log(result)\r\n\t\t\t\t\tlet letter = \"\";\r\n\t\t\t\t\tlet data = [];\r\n\t\t\t\t\tlet extNames = [\"省直辖县级行政区划\", \"自治区直辖县级行政区划\", \"县\"];\r\n\t\t\t\t\tlet recommend = [];\r\n\t\t\t\t\tresult.data.map(item => {\r\n\t\t\t\t\t\tif (item.first_letter != letter) {\r\n\t\t\t\t\t\t\tif (letter) {\r\n\t\t\t\t\t\t\t\t//插入到原数组里面\r\n\t\t\t\t\t\t\t\tthis.dataList.push({\r\n\t\t\t\t\t\t\t\t\tletter: letter,\r\n\t\t\t\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//新起一个数组\r\n\t\t\t\t\t\t\tletter = item.first_letter;\r\n\t\t\t\t\t\t\tdata = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//暂且认为城市名称不重复，这几条要排除在外:省直辖县级行政区划、自治区直辖县级行政区划、县\r\n\t\t\t\t\t\tif (extNames.indexOf(item.name) == -1) {\r\n\t\t\t\t\t\t\tdata.push(item.name)\r\n\t\t\t\t\t\t\tif (item.is_recommend) {\r\n\t\t\t\t\t\t\t\trecommend.push(item.name)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//判断直辖市\r\n\t\t\t\t\t\t\tif (this.zhixiashi[item.name]) {\r\n\t\t\t\t\t\t\t\tthis.codeList[item.name] = this.zhixiashi[item.name];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.codeList[item.name] = item.code;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t//推荐列表\r\n\t\t\t\t\tif (recommend.length > 0) {\r\n\t\t\t\t\t\tthis.dataList.unshift({\r\n\t\t\t\t\t\t\tletter: this.hotLetter,\r\n\t\t\t\t\t\t\tdata: recommend\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//最后一个数组\r\n\t\t\t\t\tthis.dataList.push({\r\n\t\t\t\t\t\tletter: letter,\r\n\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t})\r\n\t\t\t\t\t//获取当前定位城市\r\n\t\t\t\t\tthis.getLocation();\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetLocation() {\r\n\t\t\t\tuni.getLocation({\r\n\t\t\t\t\tsuccess: (e) => {\r\n\t\t\t\t\t\tconsole.log(\"getLocation\", e)\r\n\t\t\t\t\t\t//根据经纬度，获得城市\r\n\t\t\t\t\t\tthis.$request(\"utils/getLocationAddress\", {\r\n\t\t\t\t\t\t\tfromLatlng: [e.latitude, e.longitude].join()\r\n\t\t\t\t\t\t}).then(data => {\r\n\t\t\t\t\t\t\tconsole.log(\"data\", data)\r\n\t\t\t\t\t\t\tif (data.ad_info) {\r\n\t\t\t\t\t\t\t\t//需要处理直辖市\r\n\t\t\t\t\t\t\t\tif (this.codeList[data.ad_info.district]) {\r\n\t\t\t\t\t\t\t\t\t//区县\r\n\t\t\t\t\t\t\t\t\tthis.localCity = {\r\n\t\t\t\t\t\t\t\t\t\tname: data.ad_info.district + \"（当前定位）\",\r\n\t\t\t\t\t\t\t\t\t\trealName: data.ad_info.district,\r\n\t\t\t\t\t\t\t\t\t\tcode: this.codeList[data.ad_info.district]\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (this.zhixiashi[data.ad_info.province]) {\r\n\t\t\t\t\t\t\t\t\tthis.localCity = {\r\n\t\t\t\t\t\t\t\t\t\tname: data.ad_info.province + \"（当前定位城市）\",\r\n\t\t\t\t\t\t\t\t\t\trealName: data.ad_info.province,\r\n\t\t\t\t\t\t\t\t\t\tcode: this.zhixiashi[data.ad_info.province]\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t//普通城市\r\n\t\t\t\t\t\t\t\t\tthis.localCity = {\r\n\t\t\t\t\t\t\t\t\t\tname: data.ad_info.city + \"（当前定位城市）\",\r\n\t\t\t\t\t\t\t\t\t\trealName: data.ad_info.city,\r\n\t\t\t\t\t\t\t\t\t\tcode: this.codeList[data.ad_info.city]\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tconsole.log(\"this.localCity\", this.localCity)\r\n\t\t\t\t\t\t\t\t//判断是否存在热门\r\n\t\t\t\t\t\t\t\tlet hot = this.dataList[0].letter == this.hotLetter;\r\n\t\t\t\t\t\t\t\tthis.codeList[this.localCity.name] = this.localCity.code;\r\n\t\t\t\t\t\t\t\tif (hot) {\r\n\t\t\t\t\t\t\t\t\tlet localIndex = this.dataList[0].data.findIndex(e => this\r\n\t\t\t\t\t\t\t\t\t\t.localCity.name\r\n\t\t\t\t\t\t\t\t\t\t.indexOf(e) == 0);\r\n\t\t\t\t\t\t\t\t\tif (localIndex != -1) {\r\n\t\t\t\t\t\t\t\t\t\tthis.dataList[0].data.splice(localIndex, 1)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tthis.dataList[0].data.unshift(this.localCity.name)\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.dataList.unshift({\r\n\t\t\t\t\t\t\t\t\t\tletter: this.hotLetter,\r\n\t\t\t\t\t\t\t\t\t\tdata: [\r\n\t\t\t\t\t\t\t\t\t\t\tthis.localCity.name\r\n\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync chooseCity(e) {\r\n\t\t\t\tconsole.log(\"chooseCity\", e, this.codeList[e.item.name])\r\n\t\t\t\tlet city = {\r\n\t\t\t\t\tcode: this.codeList[e.item.name],\r\n\t\t\t\t\tname: e.item.name\r\n\t\t\t\t}\r\n\t\t\t\t//判断选择的城市是否为定位城市\r\n\t\t\t\tif (this.localCity && this.localCity.code == city.code) {\r\n\t\t\t\t\tcity.name = this.localCity.realName;\r\n\t\t\t\t}\r\n\t\t\t\tuni.setStorage({\r\n\t\t\t\t\tkey: \"user_select_city\",\r\n\t\t\t\t\tdata: city\r\n\t\t\t\t});\r\n\t\t\t\tif (this.save && this.isLogin) {\r\n\t\t\t\t\tawait db.collection(\"uni-id-users\").where(\"_id==$cloudEnv_uid\").update({\r\n\t\t\t\t\t\tselect_city: city\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//刷新用户信息\r\n\t\t\t\t\tthis.$store.dispatch('user/getUserInfo');\r\n\t\t\t\t}\r\n\t\t\t\tthis.$success(\"设置成功\");\r\n\t\t\t\tthis.navTimeBack(true, 1500, () => {\r\n\t\t\t\t\t//重新加载首页\r\n\t\t\t\t\tthis.$store.dispatch('app/init', {\r\n\t\t\t\t\t\tcity\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\r\n</style>\n"],"sourceRoot":""}