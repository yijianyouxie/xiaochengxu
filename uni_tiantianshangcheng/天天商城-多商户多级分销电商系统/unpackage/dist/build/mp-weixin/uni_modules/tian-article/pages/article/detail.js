(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["uni_modules/tian-article/pages/article/detail"],{"0853":function(t,e,n){"use strict";n.r(e);var i=n("2698"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},2698:function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(n("681d"));a(n("fb22"));function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=t.database(),l={mixins:[o.default],data:function(){return{id:"",isFav:!1,isGetScore:!1,loaded:!1,where:"",content:"",commentList:[],item:{}}},onLoad:function(t){this.id=t.id,this.loadData()},onShow:function(){this.checkFav()},onReachBottom:function(){console.log("加载下一页评论，滑动到底部，增加积分"),this.item.task&&!this.isGetScore&&this.checkBindMobile("必须绑定手机才能做任务")&&(this.isGetScore=!0,this.item.task.normal&&this.articleRead(this.item.task)),this.loadCommentData()},computed:{isLogin:function(){return this.$store.getters["user/isTokenValid"]},userInfo:function(){return this.$store.state.user.userInfo},adConfig:function(){return this.$store.state&&this.$store.state.app.adConfig&&this.$store.state.app.adConfig.article&&this.$store.state.app.adConfig.article.detail?this.$store.state.app.adConfig.article.detail:{}},bottomAdpid:function(){return!!this.adConfig.bottom&&this.adConfig.bottom},topAdpid:function(){return!!this.adConfig.top&&this.adConfig.top},canGetDoubleScore:function(){return this.item.task&&this.item.task.multiple&&(this.adConfig.signin||this.adConfig.video)}},methods:{submitComment:function(t){var e=this;if(this.isLogin)if(this.content){i.showLoading({title:"提交中",mask:!0});var n={article_id:this.id,user_id:u.env.uid,user:{avatar:this.userInfo.avatar,nickname:this.userInfo.nickname},like_count:0,comment_type:0,comment_content:this.content,reply_comment_id:t?t._id:"",reply_user_id:t?t.user_id:""};u.collection("opendb-news-comments").add(n).then((function(t){var o=t.result;console.log("res",o),i.hideLoading(),i.showToast({title:"发布成功"}),n._id=o.id,n.user_id=[e.userInfo],n.comment_date=Date.now();var a=[n];e.buildComment(a),e.commentList=a.concat(e.commentList),e.content=""}))}else i.showToast({icon:"none",title:"请输入评论内容"});else this.navToLoginNotice()},loadCommentData:function(){var t=this;this.item.comment_status?"noMore"!=this.loadingType&&(this.loadingType,this.page++,u.collection("opendb-news-comments").where('article_id=="'.concat(this.id,'" && reply_comment_id==""')).field("comment_content,like_count,comment_type,reply_user_id,reply_comment_id,comment_date,user").orderBy("comment_date desc").skip((this.page-1)*this.limit).limit(this.limit).get().then((function(e){var n=e.result;n.data.length<t.limit?t.loadingType="noMore":t.loadingType="more",t.buildComment(n.data),1==t.page?t.commentList=n.data:t.commentList=t.commentList.concat(n.data)}))):console.log("文章不支持评论")},buildComment:function(t){var e={avatar:"/static/missing-face.png",nickname:"匿名"};t.forEach((function(t){t.user?t.user=c(c({},e),t.user):t.user=e}))},loadData:function(){var t=this,e=this.getItemData();this.buildData(e),u.action("article_read").collection("opendb-news-articles,uni-id-users").foreignKey("opendb-news-articles.user_id").where('article_status==1 && _id=="'.concat(this.id,'"')).field("avatar,title,excerpt,publish_date,like_count,source_from,view_count,user_id.nickname,content,comment_count,comment_status").get({getOne:!0}).then((function(e){var n=e.result;t.buildData(n.data),t.isLogin&&t.$store.commit("mall/UPDATE_ARTICLE_READ",t.item._id),t.loaded=!0}))},buildData:function(t){t&&(i.setNavigationBarTitle({title:t.title}),t.avatar&&(t.avatar=this.$thumbImg(t.avatar,"750x400")),"object"==typeof t.user_id&&(t.user_id&&t.user_id.length>0?t.user_id=t.user_id[0].nickname:t.user_id=""),t.content&&(t.content=this.$repairImageSize(t.content)),this.item=t)},checkFav:function(){var t=this;u.collection("opendb-news-favorite").where('user_id==$cloudEnv_uid && article_id=="'.concat(this.id,'"')).field("_id").get({getOne:!0}).then((function(e){var n=e.result;console.log("checkFav result",n),t.isFav=n.data.length>0})).catch((function(t){console.log("未登录")}))},unFav:function(){var t=this;i.showModal({content:"是否确定取消收藏？",success:function(e){e.confirm&&(i.showLoading({mask:!0}),u.collection("opendb-news-favorite").where('user_id==$cloudEnv_uid && article_id=="'.concat(t.id,'"')).remove().then((function(){i.hideLoading(),t.isFav=!1,i.showToast({title:"取消成功"})})).catch((function(){i.hideLoading(),i.showToast({icon:"none",title:"取消失败"})})))}})},fav:function(){var t=this;this.isLogin?(i.showLoading({mask:!0}),u.action("article_favorite").collection("opendb-news-favorite").where({user_id:u.env.uid,article_id:this.id}).field("_id").get({getOne:!0}).then((function(e){e.result;t.isFav=!0,console.log("fav result"),i.hideLoading(),i.showToast({title:"收藏成功"})})).catch((function(){i.hideLoading(),i.showToast({icon:"none",title:"收藏失败"})}))):this.navToLoginNotice((function(){t.checkFav()}))},finishTaskResult:function(t){this.item.task.log=c(c({},t),{},{task:void 0}),this.item.task.multiple=t.task.multiple,t.getDouble?this.$message("阅读翻倍奖励 +".concat(t.task.bounty)):t.getScore?this.$message("阅读奖励 +".concat(t.task.bounty)):t.needMore?this.$message("已完成".concat(t.amount,"次")):t.result}}};e.default=l}).call(this,n("a9ff")["default"],n("543d")["default"])},2753:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={uniDateformat:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat")]).then(n.bind(null,"3a22"))},uniLoadMore:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-load-more/components/uni-load-more/uni-load-more")]).then(n.bind(null,"458a"))},tianIcons:function(){return n.e("uni_modules/tian-mall/components/tian-icons/tian-icons").then(n.bind(null,"6439"))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,"549f"))},tianEmpty:function(){return n.e("uni_modules/tian-mall/components/tian-empty/tian-empty").then(n.bind(null,"2789"))}},o=function(){var t=this,e=t.$createElement;t._self._c},a=[]},"3ace":function(t,e,n){"use strict";var i=n("ebee"),o=n.n(i);o.a},"87cf":function(t,e,n){"use strict";(function(t){n("566f");i(n("66fd"));var e=i(n("95f5"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"95f5":function(t,e,n){"use strict";n.r(e);var i=n("2753"),o=n("0853");for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("3ace");var s,c=n("f0c5"),r=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);e["default"]=r.exports},ebee:function(t,e,n){}},[["87cf","common/runtime","common/vendor"]]]);