(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/detail"],{"1ff5":function(t,o,i){"use strict";i.d(o,"b",(function(){return e})),i.d(o,"c",(function(){return u})),i.d(o,"a",(function(){return n}));var n={uniSwiperDot:function(){return i.e("uni_modules/uni-swiper-dot/components/uni-swiper-dot/uni-swiper-dot").then(i.bind(null,"8328"))},tianGoodsPrice:function(){return i.e("uni_modules/tian-mall/components/tian-goods-price/tian-goods-price").then(i.bind(null,"5efb"))},tianIcons:function(){return i.e("uni_modules/tian-mall/components/tian-icons/tian-icons").then(i.bind(null,"553d"))},uniRate:function(){return i.e("uni_modules/uni-rate/components/uni-rate/uni-rate").then(i.bind(null,"6612"))},jVideo:function(){return i.e("components/j-video/j-video").then(i.bind(null,"aef9"))},tianGoodsSku:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/tian-mall/components/tian-goods-sku/tian-goods-sku")]).then(i.bind(null,"6b96"))},tianGoodsNav:function(){return i.e("uni_modules/tian-mall/components/tian-goods-nav/tian-goods-nav").then(i.bind(null,"7bae"))},uniPopup:function(){return i.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(i.bind(null,"89d1"))}},e=function(){var t=this,o=t.$createElement;t._self._c},u=[]},"3ca2":function(t,o,i){"use strict";i.r(o);var n=i("3ea0"),e=i.n(n);for(var u in n)"default"!==u&&function(t){i.d(o,t,(function(){return n[t]}))}(u);o["default"]=e.a},"3ea0":function(t,o,i){"use strict";(function(t,n){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e=s(i("b3c8")),u=s(i("cbd5"));function s(t){return t&&t.__esModule?t:{default:t}}var a=t.database(),r=function(){i.e("pages/product/components/group-buying").then(function(){return resolve(i("540d"))}.bind(null,i)).catch(i.oe)},c={mixins:[e.default,u.default],components:{groupBuyingPage:r},data:function(){return{loaded:!1,current:0,bottomOptions:[],buttonGroup:[],selectSku:{},defaultSkuId:"",group_buying_id:"",item:{},description:[],allGroupBuying:[],groupBuying:[],groupBuyingTotal:0,maxShowAllGroupBuying:10,isSubmitSku:0}},onLoad:function(t){this.item=this.getItemData(),this.item||(this.item={}),this.item._id&&(this.loaded=!0),t.id&&(this.item._id=t.id),t.sku&&(this.defaultSkuId=t.sku),this.item.goods_thumb&&(this.item.goods_banner_imgs=[this.$thumbImg(this.item.goods_thumb,"750x750")]),this.loadData()},onPullDownRefresh:function(){console.log("刷新整页"),n.stopPullDownRefresh(),this.current=0,this.updateBottomOptions(),this.loadData()},onShow:function(){this.loaded&&this.getGroupBuying()},computed:{quanyiDescription:function(){return this.$store.state.app.customer.goods&&this.$store.state.app.customer.goods.priceDescription.quanyi?this.$store.state.app.customer.goods.priceDescription.quanyi:[]},priceDescription:function(){return this.$store.state.app.customer.goods&&this.$store.state.app.customer.goods.priceDescription.price?this.$store.state.app.customer.goods.priceDescription.price:[]}},methods:{loadData:function(){var t=this;a.action("goods_member,check_goods_favorite,goods_visite").collection("opendb-mall-goods").where('_id=="'.concat(this.item._id,'"')).field("goods_sn,name,shop_id,keywords,comments,comment_total_rate,goods_desc,goods_thumb,goods_summary,goods_banner_imgs,price,market_price,sku_name,is_vip,remain_count,month_sell_count,total_sell_count,comment_count,is_real,is_on_sale,is_alone_sale,is_best,is_new,is_hot,add_date,last_modify_date,use_score,use_score_rate,group_buying,group_buying_discount").get({getOne:!0}).then((function(o){var i=o.result;if(t.description=[],i.data.goods_desc&&i.data.goods_desc.length>0){new RegExp("(.jpg|.png|.jpeg|.gif)$");var n=new RegExp("(.mp4|.wma|.3gp)$"),e=[];i.data.goods_desc.map((function(o){if(o.indexOf("http")>-1)return n.test(o.toLowerCase())?(e.length>0&&t.description.push({type:"html",content:e.join("")}),e=[],void t.description.push({type:"video",content:o})):void e.push('<img src="'.concat(o,'" style="width:100%;display:block;"/>'));e.push('<p style="padding:12px;">'.concat(o,"</p>"))})),e.length>0&&t.description.push({type:"html",content:e.join("")}),console.log(t.description)}i.data.goods_banner_imgs||(i.data.goods_banner_imgs=[],i.data.goods_banner_imgs.unshift(i.data.goods_thumb)),t.item=i.data,t.loaded=!0,t.buildData(),t.updateBottomOptions(),t.getGroupBuying()})),this.updateBottomOptions(),this.$store.state.app&&this.$store.state.app.customer&&this.$store.state.app.customer.maxShowAllGroupBuying&&(this.maxShowAllGroupBuying=this.$store.state.app.customer.maxShowAllGroupBuying)},buildData:function(t){var o=this;this.item.goods_banner_imgs&&(this.item.goods_banner_imgs=this.item.goods_banner_imgs.map((function(t){return o.$thumbImg(t,"750x750")})))},getGroupBuying:function(){var t=this;if(this.item.group_buying){var o=this.$store.state.user.userInfo;a.collection("opendb-mall-goods-group-buying,uni-id-users").where('goods_id=="'.concat(this.item._id,'" && state==1')).field("group_id,user_id.avatar,user_id._id,user_id.nickname,end_time").orderBy("create_time asc").get().then((function(i){var n=i.result;console.log(n);var e={};t.groupBuyingTotal=0,n.data.map((function(i){var n=t.buildUserInfo(i.user_id[0]);e[i.group_id]||(e[i.group_id]={avatar:[],nickname:[],id:i.group_id,enable:!0,index:t.item.group_buying,amount:t.item.group_buying}),e[i.group_id].index--,n._id==o._id&&(e[i.group_id].enable=!1,e[i.group_id].index+=1e3),e[i.group_id].avatar.push(n.avatar),e[i.group_id].nickname.push(n.nickname),e[i.group_id].amount--,t.groupBuyingTotal++})),t.allGroupBuying=[];var u=[];for(var s in e)t.allGroupBuying.length<t.maxShowAllGroupBuying&&t.allGroupBuying.push(e[s]);t.allGroupBuying.sort((function(t,o){return t.index-o.index})),t.allGroupBuying.map((function(t){u.length<2&&u.push(t)})),t.groupBuying=u}))}},updateBottomOptions:function(){var t=[{icon:"dianpu",text:"首页"}];this.item.is_fav?t.push({icon:"biaoxingfill",color:"#ff5a1d",text:"已收藏"}):t.push({icon:"biaoxing",color:"#646566",text:"收 藏"}),t.push({icon:"gouwuche",text:"购物车"}),this.bottomOptions=t,this.buttonGroup=[{text:"加入购物车",backgroundColor:"#ffa200",color:"#fff"},{text:"立即购买",backgroundColor:"#ff0000",color:"#fff"}],this.item.group_buying?this.buttonGroup=[{text:"立即购买",backgroundColor:"#aeaeae",color:"#fff"},{text:"拼单购买",backgroundColor:"#e64340",color:"#fff"}]:this.item.is_real||(this.buttonGroup=[{text:"立即购买",backgroundColor:"#ff0000",color:"#fff"}])},saveFav:function(){var t=this;this.isLogin?this.$request("mall/goods/favorite",{goods_id:this.item._id,isFav:!this.item.is_fav},{loading:!0}).then((function(o){t.item.is_fav=o,console.log("fav result",o),t.updateBottomOptions(),t.$success(o?"收藏成功":"取消成功")})):this.navToLoginNotice()},change:function(t){this.current=t.detail.current},resetTabCartCount:function(){console.log("resetTabCartCount"),this.updateBottomOptions()},leftClick:function(t){0==t.index?n.switchTab({url:"/pages/index/index"}):1==t.index?this.saveFav():n.switchTab({url:"/pages/index/cart"})},buttonClick:function(t){console.log("buttonClick",t.index,this.item),this.isSubmitSku=t.index+1,this.item.group_buying?(this.isSubmitSku=t.index+2,this.group_buying_id=""):this.item.is_real||(this.isSubmitSku=4),console.log("this.isSubmitSku",this.isSubmitSku),this.$refs.tianSkuPop.open()},openSku:function(){this.isSubmitSku=0,this.$refs.tianSkuPop.open()},changeSku:function(t){console.log("changeSku",t),this.selectSku=t},showMoreGb:function(){this.allGroupBuying.length>0&&this.$refs.gbPopup.open()},closeGb:function(){this.$refs.gbPopup.close()},changeGb:function(t){},btnGroupBuying:function(t){this.$refs.gbPopup.close(),this.isSubmitSku=4,this.group_buying_id=t,this.$refs.tianSkuPop.open()}}};o.default=c}).call(this,i("a9ff")["default"],i("543d")["default"])},"409f":function(t,o,i){},ba87:function(t,o,i){"use strict";(function(t){i("7a45");n(i("66fd"));var o=n(i("cf98"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(o.default)}).call(this,i("543d")["createPage"])},cf98:function(t,o,i){"use strict";i.r(o);var n=i("1ff5"),e=i("3ca2");for(var u in e)"default"!==u&&function(t){i.d(o,t,(function(){return e[t]}))}(u);i("faa9");var s,a=i("f0c5"),r=Object(a["a"])(e["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);o["default"]=r.exports},faa9:function(t,o,i){"use strict";var n=i("409f"),e=i.n(n);e.a}},[["ba87","common/runtime","common/vendor"]]]);