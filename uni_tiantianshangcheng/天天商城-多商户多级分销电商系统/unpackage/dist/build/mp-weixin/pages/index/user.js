(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/user"],{"09d2":function(e,t,n){"use strict";n.r(t);var o=n("4a36"),i=n("e407");for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("8daa");var r,a=n("f0c5"),u=Object(a["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);t["default"]=u.exports},"188f":function(e,t,n){},"4a36":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}));var o={tianIcons:function(){return n.e("uni_modules/tian-mall/components/tian-icons/tian-icons").then(n.bind(null,"6439"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"36ef"))},uniPopupDialog:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(n.bind(null,"a92f"))}},i=function(){var e=this,t=e.$createElement;e._self._c},s=[]},"8daa":function(e,t,n){"use strict";var o=n("188f"),i=n.n(o);i.a},b8ea:function(e,t,n){"use strict";(function(e){n("566f");o(n("66fd"));var t=o(n("09d2"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},cff9:function(e,t,n){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=u(n("a34a")),s=u(n("a963")),r=u(n("681d")),a=n("2e4f");function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,o,i,s,r){try{var a=e[s](r),u=a.value}catch(c){return void n(c)}a.done?t(u):Promise.resolve(u).then(o,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function r(e){c(s,o,i,r,a,"next",e)}function a(e){c(s,o,i,r,a,"throw",e)}r(void 0)}))}}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=e.database(),d={mixins:[s.default,r.default],data:function(){return{hasSign:!1,adminShops:[],showTeamPopup:!1,taskBtnText:"",signTask:{},orderList:[],stateMap:{},optionDataList:[],options:h({},a.enumConverter)}},computed:{isLogin:function(){return this.$store.getters["user/isTokenValid"]},userInfo:function(){return this.$store.state.user.userInfo},userScore:function(){return parseInt(this.userInfo.score)},adConfig:function(){return this.$store.state&&this.$store.state.app.adConfig&&this.$store.state.app.adConfig.tasks?this.$store.state.app.adConfig.tasks:{}},scoreName:function(){return this.$store.state.app.customer.scoreName?this.$store.state.app.customer.scoreName:"积分"}},watch:{stateMap:function(e){console.log("watch stateMap",e),this.initOrder()}},onLoad:function(){o.hideLoading(),this.initOrder(),this.initOptions()},onShow:function(){console.log("user onShow"),this.getStatistics()},methods:{getStatistics:function(){var e=this;this.isLogin?(this.$request("user/info/info").then((function(t){console.log("user statitics",t),e.$store.commit("user/SET_USER_INFO",t),e.initOptions()}),(function(e){console.log("getStatistics err",e)})),this.getSignTask(),g.collection("tian-mall-orders").where("user_id==$cloudEnv_uid && is_delete==0").groupBy("state").groupField("count(*) as total").get().then((function(t){var n=t.result,o={};console.log("user statitics2",n.data),n.data.forEach((function(e){o[e.state]=e.total})),e.stateMap=o})),this.getShopAdmin()):(this.stateMap={},this.initOptions(),this.adminShops=[])},getShopAdmin:function(){var e=this;return l(i.default.mark((function t(){var n,o,s,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,g.collection("tian-mall-shops").where("uid==$cloudEnv_uid || employees==$cloudEnv_uid").field("name,id,src,online,address,phone,apply_id").limit(20).get();case 2:return n=t.sent,o=n.result,s=[],o.data.forEach((function(e){e.page="/pages/enterprise/detail",e.apply_id&&s.push(e.apply_id)})),t.next=8,e.getShopApply(s);case 8:r=t.sent,e.adminShops=o.data.concat(r),console.log("tian-mall-shops",o);case 11:case"end":return t.stop()}}),t)})))()},getShopApply:function(e){var t=this;return l(i.default.mark((function n(){var o,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,g.collection("tian-mall-shop-apply").where("uid==$cloudEnv_uid").field("name,src,address,phone,id,state,apply_result").limit(200).get();case 2:return o=n.sent,s=o.result,n.abrupt("return",s.data.filter((function(t){return-1==e.indexOf(t._id)})).map((function(e){return e.isApply=!0,e.page="/pages/enterprise/apply?id="+e._id,e.stateText=t.options.state_valuetotext[e.state],0==e.state&&(e.apply_result=!1),e})));case 5:case"end":return n.stop()}}),n)})))()},getSignTask:function(){var e=this;this.$request("user/info/sign_task",{},{}).then((function(t){e.buildSignTask(t)}))},buildSignTask:function(e){e&&(this.hasSign=!0,this.taskBtnText="签到",e.log&&e.log.result&&(this.taskBtnText="已签到",e.open_url=!1),this.signTask=e,console.log("this.signTask",this.signTask))},buildTaskResult:function(e){delete e.task,this.signTask.log=e,this.buildSignTask(this.signTask)},navToSign:function(){this.signTask.open_url?this.navTo(this.signTask.open_url,this.signTask):this.$message("今日已签到")},logout:function(){var e=this;this.confirmAction((function(){e.$request("user/login/logout").then((function(t){console.log("退出成功",t),e.localLogout()}),(function(t){console.log("退出失败",t),e.localLogout()}))}),"是否确定退出系统？")},localLogout:function(){this.$store.commit("user/REMOVE_TOKEN"),this.$store.commit("user/SET_USER_INFO",{}),this.$store.commit("mall/UPDATE_CART_NUMBER",0),this.stateMap={}},checkTeam:function(){var e=this;if(!this.userInfo.inviter_uid||0==this.userInfo.inviter_uid.length)return this.showTeamPopup=!0,void this.$nextTick((function(){e.$refs.teamPopup.open()}));this.navTo("/pages/user/team/team")},closeInvite:function(){var e=this;o.showModal({title:"邀请提示",content:"是否确定放弃填写邀请人的权利？",confirmText:"放弃权利",cancelText:"暂时不填",success:function(t){t.confirm?e.$request("user/info/jointeam",{mobile:"none"},{loading:!0}).then((function(t){console.log("jointeam",t),e.$store.dispatch("user/getUserInfo"),e.navTo("/pages/user/team")})):e.$refs.teamPopup.close()}})},confirmInvite:function(e){var t=this;if(!e)return this.$message("请填写邀请码"),!1;this.$request("user/info/jointeam",{mobile:e},{loading:!0}).then((function(e){console.log("jointeam",e),t.$success("邀请成功"),t.$store.dispatch("user/getUserInfo"),t.$refs.teamPopup.close()}))},initOptions:function(){var e=5,t="#ec6535",n="#51b2f9",o=[{type:"gouwudai",text:"分销业绩",checkLogin:!0,open_url:"/pages/user/achievement"},{type:"renwu",text:"每日任务",checkLogin:!0,checkMobile:!0,open_url:"/pages/user/tasks"},{type:"fenxiang",text:"分享好友",checkLogin:!0,checkMobile:!0,open_url:"/pages/user/invite"},{type:"shangji1",text:"申请渠道",checkLogin:!0,checkMobile:!0,open_url:"/pages/user/channel?type=1"},{type:"shoucang",text:"我的收藏",checkLogin:!0,open_url:"/pages/product/favorite"},{type:"zuji",text:"我的足迹",checkLogin:!0,open_url:"/pages/product/visite"},{type:"zuobiao",text:"收货地址",checkLogin:!0,open_url:"/pages/address/list"},{type:"tongji",text:this.scoreName+"排行",checkLogin:!0,open_url:"/pages/user/score/ranking"},{type:"gonglve",text:"余额明细",checkLogin:!0,open_url:"/pages/user/balances"},{type:"liebiaoxingshi",text:this.scoreName+"明细",checkLogin:!0,open_url:"/pages/user/scores"},{type:"zhengli",text:this.scoreName+"互转",checkLogin:!0,open_url:"/pages/user/score/transfer"},{type:"tuikuan",text:this.scoreName+"兑换",checkLogin:!0,open_url:"/pages/user/score/cashout"},{type:"hongbao",text:"余额提现",checkLogin:!0,open_url:"/pages/user/cashout"},{type:"shezhi",text:"个人设置",checkLogin:!0,open_url:"::navToUserInfo"},{type:"kefu",text:"联系客服",open_url:"/pages/app/contact"},{type:"bangzhuzhongxin",text:"关于我们",open_url:"/pages/app/about"}];o.unshift({type:"pengyou",text:"我的团队",checkLogin:!0,checkMobile:!0,open_url:"::checkTeam"}),o.unshift({type:"dianpu",text:"门店入驻",checkLogin:!0,checkMobile:!0,open_url:"/pages/enterprise/apply"}),console.log("this.userInfo.role ",this.userInfo.role),this.userInfo&&this.userInfo.role&&-1!=this.userInfo.role.indexOf("admin")&&o.push({type:"danpin",text:"系统管理",mustLogin:!0,open_url:"/pages/admin/admin"}),o.forEach((function(o,i){parseInt(i/e)%2==1?o.color=n:o.color=t})),this.optionDataList=o},initOrder:function(){var e=this,t=5,n="#ec6535",o="#51b2f9",i=[{type:"baoguofahuo-xianxing",text:"待付款",checkLogin:!0,state:0,open_url:"/pages/order/order?type=unpay"},{type:"baoguofahuo",text:"待发货",checkLogin:!0,state:1,open_url:"/pages/order/order?type=undelivery"},{type:"yunshuzhongwuliu",text:"待收货",checkLogin:!0,state:2,open_url:"/pages/order/order?type=unreceived"},{type:"liuyanfill",text:"待评价",checkLogin:!0,state:3,open_url:"/pages/order/comment"},{type:"chaibaoguoqujian",text:"退换货",checkLogin:!0,state:4,open_url:"/pages/order/service"}];i.forEach((function(i,s){e.stateMap[i.state]?i.total=e.stateMap[i.state]:i.total=0,parseInt(s/t)%2==1?i.color=o:i.color=n})),this.orderList=i},getPhoneNumber:function(e){var t=this;console.log("getPhoneNumber",e),e.detail.iv&&this.$request("user/login/weixin_phone",h(h({},e.detail),{},{sessionKey:this.$store.state.user.sessionKey,uid:this.$store.state.user.userInfo._id,openid:this.$store.state.user.openid}),{loading:!0}).then((function(e){console.log("getPhoneNumber",e),t.getStatistics()}))},navToUserInfo:function(){var e=this;this.userInfo.hasNickName||!wx.getUserProfile?this.navTo("/pages/user/info",{},{login:!0}):wx.getUserProfile({desc:"用于完善会员资料",success:function(t){console.log("wx.getUserProfile res",t);var n=t.userInfo;e.editData({nickname:n.nickName,gender:n.gender,avatar:n.avatarUrl,province:n.province,city:n.city,country:n.country})}})},editData:function(e){var t=this;console.log("editData",e),this.$request("user/info/edit",e,{loading:!0}).then((function(e){t.$store.dispatch("user/getUserInfo")}))},changeAccount:function(){}}};t.default=d}).call(this,n("a9ff")["default"],n("543d")["default"])},e407:function(e,t,n){"use strict";n.r(t);var o=n("cff9"),i=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=i.a}},[["b8ea","common/runtime","common/vendor"]]]);